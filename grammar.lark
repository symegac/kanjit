start: (instruction | block)+

?instruction: statement "„ÄÇ"

?statement: simple_statement
         | function
         | loop_line
         | if_line
?simple_statement.10: declaration
                    | assignment
                    | function_call

// declaration & assignment
declaration: id type "‰πü"
assignment: type? id "ÊòØ"? value "‰πü"
     // assignment: type? "ÊâÄ" id "ÊòØ" value "‰πü"
backassignment: if back_part
back_part: (value | id | action (value | id)) "‰πã"
     // backassignment_block: if back_part ("„ÄÇ" "Âà•" if back_part)? ("„ÄÇ" "‰ªñ" back_part)? "„ÄÇ" "‰∫Ü"

// identifiers & sub
?id: identifier | parent_child
identifier: (ASCII | JAPANESE)+
parent_child: id "„É∂" child
?child: (property | index)
property: LEN | id
index: CURR | integer

// blocks
?block: (loop_block | if_block) "„ÄÇ"
// iteration
loop_line: iterable "„Ä±" (simple_statement | if_line) "„Ä≤"
loop_block: iterable "„Ä±" (instruction | block)+ "„Ä≤"
iterable: id | optionals
optionals: "‰ª•„ÄÖ"
// comparison
?if_line.20: if simple_statement ("‰ªñ" simple_statement)? | backassignment
?if_block: if then ("Âà•" elif)? ("‰ªñ" else)? "‰∫Ü"
if: (bool_block bool_comp)* bool_block ("Ô©õ" | "ËÄÖ")
?bool_block.10: comparison | value | id
then: "ÊñØ" "„ÄÇ" instruction+
?elif: if then
else: "ÊñØ" "„ÄÇ" instruction+

// operators
unary_operator: INCR | DECR
binary_operator: ADD | SUB | MULT | DIV | HALF | DOUBLE | POW | SQRT
bool_comp: AND | OR | NOT
         | NOT AND | NOT OR
comparison: (value | id) comparative_operator (value | id) | between
comparative_operator: EQ | GT | LT | GE | LE
                    | NOT comparative_operator
between: (value | id) "‰∏ç"? "‰∏≠" (value | id) "‰πÉËá≥" (value | id)

// functions
// definitions
function: "ÂÆö" function_header "ÊñØ" "„ÄÇ" function_body "‰∫Ü"
?function_header: parameters "„Çí" function_name ("‰ª•" optional_parameters)? ("Êàê" out_parameters)?
?parameters: parameter (parameter_separator? parameter)*
parameter: type id
?optional_parameters: optional_parameter (parameter_separator? optional_parameter)*
optional_parameter: parameter default?
?out_parameters: out_parameter (parameter_separator? out_parameter)*
out_parameter: parameter default?
?parameter_separator: AND | CTXSEP
default: "Ëã•" (value | id)
function_body: (instruction | block)* returner?
returner: "Êàê" (value | id)? "„ÄÇ"
// calls
function_call: call_parameters "„Çí" function_name ("‰ª•" call_optionals)? | do_self
?call_parameters: call_parameter (parameter_separator? call_parameter)*
call_parameter.20: value | id // call_parameter.2
?call_optionals: call_optional (parameter_separator? call_optional)*
call_optional: id value
function_name: id | builtins
// self-action
do_self: (value | id) "Ëá™" action (value | id)
action: function_name | binary_operator

// values
value: single_value
     | multi_value
     | NULL
?single_value: boolean
             | character
             | number
?multi_value: bitarray
            | string
            | sequence
            | structure
            | bitmap
            | matrix
            | catalog
            | bitmap
// 1d
boolean: TRUE | FALSE
character: "„Äê" TEXT? "„Äë"
?number: integer
       | floating_point
sign: NEG?
integer: sign? DIGITS
floating_point: sign? DIGITS? "ÂàÜ" DIGITS
// 2d
bitarray: ("„Äà" | "<") boolean+ ("„Äâ" | ">")
string: "„Äå" TEXT* "„Äç" | "„Äå" (character | id)? ("„ÄÅ" (character | id))* "„Äç"
sequence: ("Ôºà" | "(") (number | id)? ("„ÄÅ" (number | id))* ("Ôºâ" | ")")
dictionary: "weerh"
structure: "aaaaaaa"
// 3d
bitmap: ("„Ää" | "<") bitarray+ ("„Äã" | ">")
matrix: ("Ôºª" | "[") (sequence | id)? ("„ÄÅ" (sequence | id))* ("ÔºΩ" | "]")
catalog: "„Äé" (string | id)? ("„ÄÅ" (string | id))* "„Äè"

// text & numbers
TEXT: (ASCII | JAPANESE | DIGITS)+
JAPANESE: (KANJI | HIRAGANA | KATAKANA)+
KANJI: "ÂÖ•" | "Âá∫" | "ËøÑ" | "ÊØé" | "Âäõ"
HIRAGANA: "„ÅÅ".."„Çë" | "„Çì".."„Çü" | "õÑ≤".."õÖí" | "„Éº" | "„Ç†" | HENTAIGANA // no „Çí
HENTAIGANA: "õÄÅ".."õÑ¢"
KATAKANA: "„Ç°".."„Éµ" | "„É∑".."„Éø" | "õÄÄ" | "õÖï".."õÖß" | "„á∞".."„áø" |  "ÔΩ¶".."Ôæü" | "„Ç†" // no „É∂
ASCII: "A".."√ø"
DIGITS: DIGIT+ | JAPANESE_DIGIT+
DIGIT: "0".."9"
JAPANESE_DIGIT: ZERO
              | ONE | TWO | THREE | FOUR | FIVE
              | SIX | SEVEN | EIGHT | NINE | TEN
              | TWENTY | THIRTY | FORTY
              | HUNDRED | TENSCORE
              | THOUSAND | MYRIAD
              | LARGE_NUMBER
NEG: "Ë≤†"
ZERO: "Èõ∂" | "„Äá"
ONE: "‰∏Ä" | "Â£±" | "Â£π" | "Âºå"
TWO: "Ë≤≥" | "Ë≤Æ" | "Âºç" | "Âºê" | "‰∫å"
THREE: "ÂèÉ" | "ÂèÇ" | "Âºé" | "‰∏â"
FOUR: "ËÇÜ" | "‰∫ñ" | "Âõõ"
FIVE: "‰ºç" | "‰∫î"
SIX: "Èô∏" | "ÂÖ≠"
SEVEN: "ÊºÜ" | "Êüí" | "Ë≥™" | "‰∏É"
EIGHT: "Êçå" | "ÂÖ´"
NINE: "Áéñ" | "‰πù"
TEN: "Êãæ" | "‰ªÄ" | "ÂçÅ"
TWENTY: "ÂçÑ" | "Âªø"
THIRTY: "ÂçÖ" | "‰∏ó"
FORTY: "Âçå"
HUNDRED: "Èôå" | "‰Ω∞" | "Áôæ"
TENSCORE: "Áöï"
THOUSAND: "Èò°" | "‰ªü" | "ÂçÉ"
MYRIAD: "Ëê¨" | "‰∏á"
LARGE_NUMBER: "ÂÑÑ" | "ÂÖÜ" | "‰∫¨" | "Âûì"
            | ("Áß≠" | "•ù±") | ("Á©∞" | "Á©£")
            | "Ê∫ù" | "Êæó" | "Ê≠£" | "Ëºâ"
            | "Ê•µ" | ("ÊÅíÊ≤≥Ê≤ô" | "ÊÅÜÊ≤≥Ê≤ô")
            | ("ÈòøÂÉßÁ•á" | "ÈòøÔ®±Á•á") | "ÈÇ£Áî±‰ªñ"
            | "‰∏çÂèØÊÄùË≠∞" | ("ÁÑ°ÈáèÂ§ßÊï∏" | "ÁÑ°ÈáèÂ§ßÊï∞")

// keywords
DECL: "‰πü"
ASS: "ÊòØ"
BACKASS: "‰πã"
SELF: "Ëá™"
FUNC: "ÂÆö"
PARAM: "„Çí"
WITH: "‰ª•"
RETURN: "Êàê"
STARTDEF: "ÊñØ"
ENDSECT: "‰∫Ü"
EXISTE: "Êúâ"
NEXISTE: "ÁÑ°"
CHILD: "ÁöÑ" | "„Éµ" | "„É∂"
IN: "ÂÖß" | "ÂÜÖ"
IF: "Ô©õ" | "ËÄÖ"
ENDCLS: "„ÄÇ"
CTXSEP: "„ÄÅ"
LOOP: "„Ä±"
ENDLOOP: "„Ä≤"
CURR: "‰ªä"
ADD: "Ë∂≥"
SUB: "Âºï"
MULT: "Êéõ"
DIV: "Ââ≤"
INCR: "Â¢û" | "Â¢ó"
DECR: "Ê∏õ"
HALF: "Âçä"
DOUBLE: "ÂÄç"
POW: "‰πò" | "‰πó" | "ÂÜ™" | "‰πòÂÜ™" | "‰πóÂÜ™"
SQRT: "Ê†π"
EQ: "Áï∂" | "ÂΩì"
GT: "Âãù" | "Ë∂Ö"
LT: "Âä£" | "Êú™Êªø" | "Êú™Ê∫Ä"
GE: "‰ª•‰∏ä"
LE: "‰ª•‰∏ã"
INBETW: "‰∏≠"
ANDBETW: "‰πÉËá≥"
AND: "Âèä"
OR: "Âèà"
MAYBE: "Ëã•"
NOT: "‰∏ç"
RIGHT: "Âè≥"
LEFT: "Â∑¶"
NULL: "Á©∫"
FALSE: "ÂÉû" | "ÂÅΩ"
TRUE: "Áúû" | "Áúü"

// builtins
?builtins: APPEND | SLICE
LEN: "‰∏à"
APPEND: "‰º∏"
SLICE: "Âàá"
REP: "„ÄÖ"
DECSEP: "ÂàÜ"

// types
CHAR: "Â≠ó"
STR: "Ë®Ä"
INT: "Êï∏" | "Êï∞"
FLOAT: "ÂàÜÊï∏" | "ÂàÜÊï∞"
BOOL: TRUE FALSE
BITMASK: EXISTE NEXISTE
SEQUENCE: "Âàó"
MATRIX: "Ë°åÂàó"
CATALOG: "ÂûãÈåÑ" | "ÂûãÈå≤"
BITMAP: "Á∂ìÁ∑Ø" | "ÁµåÁ∑Ø"
STRUCT: "Êßò„ÄÖ"
DICT: "Ëæ≠Êõ∏" | "ËæûÊõ∏"

type: single_type
    | array_type
    | multi_type
    | matrix_type
size: DIGITS
msize: DIGITS
     | -> variable
rows: msize
cols: msize
single_type: CHAR -> character
           | INT -> integer
           | FLOAT -> floating_point
           | BOOL -> boolean
array_type: size single_type REP -> array
multi_type: BITMASK -> bitmask
          | STR -> string
          | SEQUENCE -> sequence
          | STRUCT -> structure
          | DICT -> dictionary
matrix_type: rows "Ë°å" cols "Âàó" -> matrix
           | cols "Âàó" rows "Ë°å" -> matrix
           | rows "Âûã" cols ("Èå≤" | "ÈåÑ") -> catalog
           | cols ("Èå≤" | "ÈåÑ") rows "Âûã" -> catalog
           | rows "Á∑Ø" cols ("Á∂ì" | "Áµå") -> bitmap
           | cols ("Á∂ì" | "Áµå") rows "Á∑Ø" -> bitmap

// type markers
LCHAR: "„Äê" | "'"
RCHAR: "„Äë" | "'"
LSTR: "„Äå" | "\""
RSTR: "„Äç" | "\""
LBIT: "„Äà" | "<"
RBIT: "„Äâ" | ">"
LSEQ: "Ôºà" | "("
RSEQ: "Ôºâ" | ")"
LMATR: "Ôºª" | "["
RMATR: "ÔºΩ" | "]"
LSET: "{"
RSET: "}"
LARR: "„Äé"
RARR: "„Äè"

// ignore whitespace
WHITESPACE: (" " | "„ÄÄ" | "\t" | "\n" | "\r")+
%ignore WHITESPACE
// ignore comments
%ignore /‚Äª.*‚Äª/